# -*- coding: utf-8 -*-
"""
Created on Wed Oct 13 00:48:19 2021

@author: willi
"""
import os
cwd = os.getcwd()
os.chdir('../..')

#print(os.getcwd())
import sys
sys.path.append( os.getcwd())
#print(sys.path)
import rsnapsim as rss
from rsnapsim import seqmanip

import numpy as np
import time
import matplotlib.pyplot as plt

os.chdir(cwd)

kdm5b = 'ATGGACTACAAGGACGACGACGACAAAGGTGACTACAAAGATGATGACGATAAAGGCGACTATAAGGACGATGACGACAAGGGCGGAAACTCACTGATCAAGGAAAACATGCGGATGAAGGTGGTGATGGAGGGCTCCGTGAATGGTCACCAGTTCAAGTGCACCGGAGAGGGAGAGGGAAACCCGTACATGGGAACTCAGACCATGCGCATTAAGGTCATCGAAGGAGGTCCGCTGCCGTTCGCTTTCGATATCCTGGCCACTTCGTTCGGAGGAGGGTCGCGCACGTTCATCAAGTACCCGAAGGGAATCCCGGACTTCTTTAAGCAGTCATTCCCGGAAGGATTCACTTGGGAACGGGTGACCCGGTATGAAGATGGAGGTGTGGTGACTGTCATGCAAGATACTTCGCTGGAGGATGGGTGCCTCGTGTACCACGTCCAAGTCCGCGGAGTGAATTTCCCGTCCAACGGACCAGTGATGCAGAAAAAGACGAAGGGTTGGGAACCTAATACTGAAATGATGTACCCCGCAGACGGAGGGCTGAGGGGCTACACCCACATGGCGCTGAAGGTCGACGGAGGAGATTACAAGGATGACGACGATAAGCAACAAGATTACAAAGACGATGATGACAAGGGCCAGCAGGGCGACTACAAGGACGACGACGACAAGCAGCAGGACTACAAAGATGACGATGATAAAGGAGGAGGACATCTGTCCTGTTCGTTCGTGACCACCTACAGATCAAAGAAAACCGTGGGAAACATCAAGATGCCGGGCATTCATGCCGTCGACCACCGCCTGGAGCGGCTCGAAGAATCAGACAATGAGATGTTCGTCGTGCAAAGAGAACATGCCGTGGCCAAGTTCGCGGGACTGGGAGGCGGTGGAGGCGATTACAAAGACGATGATGACAAGGGTGACTATAAAGACGACGATGACAAAGGGGATTACAAGGATGATGATGATAAGGGAGGCGGTGGATCAGGTGGAGGAGGTTCACTGCAGGCGATCGCCATGGAGGCGGCCACCACACTGCACCCAGGCCCGCGCCCGGCGCTGCCCCTCGGGGGCCCGGGCCCGCTGGGCGAGTTCCTGCCTCCACCCGAGTGCCCGGTCTTCGAACCCAGCTGGGAAGAGTTCGCGGACCCCTTCGCTTTCATCCACAAGATCCGGCCCATAGCCGAGCAGACTGGCATCTGTAAGGTGCGGCCGCCGCCGGATTGGCAGCCACCATTTGCATGTGATGTTGATAAACTTCATTTTACGCCACGTATCCAGAGACTGAATGAATTGGAGGCCCAAACTCGTGTAAAATTGAATTTCTTGGACCAGATTGCAAAGTACTGGGAGTTACAGGGAAGTACTCTGAAAATTCCACATGTGGAGAGGAAGATCTTGGACTTATTTCAGCTTAATAAGTTAGTTGCAGAAGAAGGTGGATTTGCAGTTGTTTGCAAGGATAGAAAATGGACCAAAATTGCTACCAAGATGGGGTTTGCTCCTGGCAAAGCAGTGGGCTCACATATCAGAGGGCATTATGAACGAATTCTCAACCCCTACAACTTATTCCTGTCCGGAGACAGCCTAAGGTGTTTGCAGAAGCCAAACCTGACCACAGACACTAAGGACAAGGAGTACAAACCCCATGATATTCCCCAGAGGCAGTCTGTGCAGCCTTCGGAAACGTGCCCCCCAGCCCGACGAGCAAAACGCATGAGAGCAGAGGCCATGAATATTAAAATAGAACCCGAGGAGACAACAGAAGCCAGAACTCATAATCTGAGACGTCGAATGGGTTGTCCAACTCCAAAATGTGAAAATGAGAAAGAAATGAAGAGTAGCATCAAGCAAGAACCTATTGAGAGGAAAGATTATATTGTAGAAAATGAGAAGGAAAAGCCCAAGAGTCGATCTAAAAAAGCCACCAATGCTGTGGACCTGTATGTCTGTCTTTTATGTGGCAGTGGCAATGATGAAGACCGGCTACTGTTGTGTGATGGCTGTGATGACAGTTACCATACCTTTTGCTTGATCCCACCTCTCCATGATGTTCCCAAGGGAGACTGGAGGTGTCCTAAGTGTTTGGCTCAGGAATGTAGTAAGCCACAAGAAGCATTTGGCTTTGAACAAGCAGCCAGGGACTATACCCTCCGTACTTTTGGGGAAATGGCAGATGCGTTCAAATCTGATTACTTCAACATGCCAGTCCATATGGTCCCCACAGAGCTTGTTGAGAAAGAATTTTGGAGACTAGTAAGCACTATTGAGGAGGATGTCACAGTGGAATATGGAGCTGACATTGCCTCAAAGGAATTTGGCAGTGGCTTTCCTGTCCGAGATGGGAAAATCAAACTCTCACCTGAGGAAGAGGAGTATCTTGATAGTGGCTGGAATTTGAACAACATGCCAGTGATGGAGCAGTCTGTCCTTGCACATATTACTGCTGATATATGTGGCATGAAACTTCCTTGGTTGTATGTGGGAATGTGCTTTTCTTCATTCTGTTGGCACATTGAAGACCACTGGAGCTATTCAATTAACTACTTGCACTGGGGTGAGCCAAAAACCTGGTATGGAGTCCCAGGGTATGCTGCTGAGCAGCTAGAAAATGTAATGAAGAAACTAGCTCCAGAACTCTTTGTGTCCCAGCCGGATCTCCTCCATCAGCTTGTGACCATCATGAACCCCAATACCCTGATGACTCATGAAGTGCCTGTTTACCGAACTAATCAGTGTGCTGGGGAGTTTGTGATTACATTTCCAAGAGCCTACCACAGTGGTTTTAACCAGGGTTTTAATTTTGCTGAGGCTGTTAACTTCTGCACTGTTGATTGGCTGCCATTAGGCCGACAGTGTGTGGAGCATTATCGCTTGCTTCATCGATATTGTGTGTTTTCCCACGATGAGATGATCTGCAAGATGGCTTCCAAGGCTGATGTATTAGATGTTGTAGTGGCTTCAACTGTTCAGAAAGACATGGCCATTATGATTGAGGATGAGAAAGCTTTAAGAGAAACTGTCCGTAAATTGGGAGTGATTGATTCGGAAAGAATGGATTTTGAGCTGTTGCCAGATGATGAACGTCAGTGTGTAAAATGCAAAACTACATGCTTCATGTCTGCCATCTCCTGTTCTTGTAAACCTGGCCTTCTTGTTTGCCTGCATCATGTAAAAGAATTGTGTTCCTGTCCTCCTTATAAATATAAATTGCGGTATAGGTACACGCTGGATGATCTCTACCCTATGATGAATGCATTGAAGCTTCGAGCAGAATCTTACAACGAATGGGCCTTGAATGTGAATGAAGCTTTGGAGGCAAAGATCAACAAGAAGAAAAGCCTTGTCAGCTTCAAGGCTTTAATTGAAGAATCTGAAATGAAGAAATTCCCAGACAATGATCTTTTGCGACACCTTCGCCTAGTCACACAGGATGCAGAGAAGTGTGCCTCTGTTGCGCAGCAGTTGCTTAATGGCAAAAGGCAAACTAGATATCGATCTGGTGGAGGGAAATCCCAAAATCAGTTGACAGTGAATGAGCTCCGGCAGTTTGTAACACAGCTGTATGCTCTTCCATGTGTCCTCAGTCAGACACCATTACTAAAGGATCTCTTGAATCGTGTAGAAGATTTTCAACAGCATAGTCAGAAACTACTCTCTGAGGAAACGCCTAGTGCTGCGGAGCTGCAGGACTTGCTAGATGTCAGCTTTGAATTTGATGTTGAACTTCCACAGCTTGCTGAGATGCGTATCCGTTTGGAACAAGCCCGTTGGCTAGAAGAGGTGCAGCAAGCTTGCCTAGACCCCAGCTCCCTTACTTTAGATGATATGAGACGTCTCATAGACCTAGGGGTAGGGCTGGCCCCGTATTCAGCAGTGGAGAAAGCTATGGCCCGGCTGCAGGAACTGCTCACAGTGTCAGAGCACTGGGACGACAAAGCCAAGAGTCTCCTCAAGGCCAGGCCACGACATTCATTGAATAGCCTTGCTACGGCAGTAAAGGAAATCGAAGAGATCCCTGCATATCTGCCCAATGGTGCGGCTCTGAAAGACTCAGTGCAGAGAGCCAGAGACTGGCTTCAGGATGTAGAGGGCCTGCAGGCTGGAGGACGTGTGCCAGTGTTAGACACACTCATAGAACTTGTTACACGAGGCCGATCTATCCCGGTACATCTGAATTCTTTGCCAAGACTGGAAACCCTAGTAGCTGAGGTTCAGGCTTGGAAAGAATGTGCTGTTAATACATTCTTGACTGAGAATTCTCCATATTCTCTCTTAGAGGTGCTGTGTCCTCGATGTGATATTGGCCTTTTGGGATTGAAAAGGAAGCAGAGAAAGTTAAAGGAGCCCTTGCCAAATGGAAAGAAAAAAAGCACCAAATTAGAGAGTCTGAGTGACCTGGAGAGAGCTTTAACTGAAAGCAAGGAGACTGCTTCAGCTATGGCAACTCTTGGGGAAGCTCGCCTAAGGGAAATGGAAGCCTTGCAGTCTCTCAGACTCGCCAATGAAGGGAAATTGCTGTCGCCTCTCCAAGATGTGGATATAAAAATCTGCCTATGTCAGAAGGCCCCAGCTGCCCCTATGATTCAATGTGAACTCTGCAGGGATGCTTTCCACACCAGTTGTGTGGCGGTACCCAGTATTTCACAGGGCCTGCGAATCTGGCTTTGTCCCCATTGTCGGAGGTCAGAGAAACCTCCATTAGAGAAAATTCTGCCCCTGCTCGCCTCCCTTCAGCGTATCCGAGTTCGCCTTCCTGAGGGAGATGCACTTCGATATATGATTGAAAGAACCGTGAACTGGCAGCACAGAGCCCAGCAACTGCTTTCGTCAGGGAATCTTAAATTTGTGCAAGATCGAGTGGGCTCAGGACTGTTATATAGCAGATGGCAAGCCTCAGCAGGACAGGTGTCAGACACAAACAAGGTATCTCAACCTCCTGGCACAACATCATTTTCTTTGCCTGATGACTGGGACAACAGAACCTCATATTTGCACTCCCCCTTCTCAACTGGACGAAGTTGTATCCCCCTCCATGGTGTTAGTCCAGAAGTGAATGAACTATTGATGGAAGCCCAGCTGCTCCAGGTATCCCTTCCTGAAATTCAGGAACTTTACCAGACTTTACTTGCAAAGCCAAGCCCTGCTCAGCAGACTGACCGAAGCTCACCAGTGAGACCCAGCAGTGAGAAGAATGACTGTTGCCGAGGGAAGCGAGATGGAATTAACAGTCTTGAGAGAAAACTGAAGAGACGCCTGGAAAGAGAGGGCCTCTCCAGTGAGCGGTGGGAACGAGTTAAGAAAATGCGGACCCCCAAAAAGAAGAAAATCAAACTGAGCCACCCCAAGGACATGAACAATTTCAAGTTAGAGAGAGAGCGTAGCTATGAATTAGTTCGTTCTGCTGAAACTCATTCCCTGCCCTCAGACACATCCTATTCCGAACAGGAAGACTCTGAGGATGAAGATGCCATCTGCCCAGCTGTGAGCTGCCTGCAGCCAGAAGGAGATGAGGTGGACTGGGTCCAGTGTGATGGCAGCTGCAATCAGTGGTTTCATCAGGTCTGTGTTGGTGTCTCCCCAGAGATGGCAGAGAAAGAAGACTACATCTGTGTGCGCTGTACTGTGAAGGACGCACCAAGCCGAAAGGTTTAA'
h2b = 'ATGGACTACAAGGACGACGACGACAAAGGTGACTACAAAGATGATGACGATAAAGGCGACTATAAGGACGATGACGACAAGGGCGGAAACTCACTGATCAAGGAAAACATGCGGATGAAGGTGGTGATGGAGGGCTCCGTGAATGGTCACCAGTTCAAGTGCACCGGAGAGGGAGAGGGAAACCCGTACATGGGAACTCAGACCATGCGCATTAAGGTCATCGAAGGAGGTCCGCTGCCGTTCGCTTTCGATATCCTGGCCACTTCGTTCGGAGGAGGGTCGCGCACGTTCATCAAGTACCCGAAGGGAATCCCGGACTTCTTTAAGCAGTCATTCCCGGAAGGATTCACTTGGGAACGGGTGACCCGGTATGAAGATGGAGGTGTGGTGACTGTCATGCAAGATACTTCGCTGGAGGATGGGTGCCTCGTGTACCACGTCCAAGTCCGCGGAGTGAATTTCCCGTCCAACGGACCAGTGATGCAGAAAAAGACGAAGGGTTGGGAACCTAATACTGAAATGATGTACCCCGCAGACGGAGGGCTGAGGGGCTACACCCACATGGCGCTGAAGGTCGACGGAGGAGATTACAAGGATGACGACGATAAGCAACAAGATTACAAAGACGATGATGACAAGGGCCAGCAGGGCGACTACAAGGACGACGACGACAAGCAGCAGGACTACAAAGATGACGATGATAAAGGAGGAGGACATCTGTCCTGTTCGTTCGTGACCACCTACAGATCAAAGAAAACCGTGGGAAACATCAAGATGCCGGGCATTCATGCCGTCGACCACCGCCTGGAGCGGCTCGAAGAATCAGACAATGAGATGTTCGTCGTGCAAAGAGAACATGCCGTGGCCAAGTTCGCGGGACTGGGAGGCGGTGGAGGCGATTACAAAGACGATGATGACAAGGGTGACTATAAAGACGACGATGACAAAGGGGATTACAAGGATGATGATGATAAGGGAGGCGGTGGATCAGGTGGAGGAGGTTCACTGCAGCCAGAGCCAGCGAAGTCTGCTCCCGCCCCGAAAAAGGGCTCCAAGAAGGCGGTGACTAAGGCGCAGAAGAAAGGCGGCAAGAAGCGCAAGCGCAGCCGCAAGGAGAGCTATTCCATCTATGTGTACAAGGTTCTGAAGCAGGTCCACCCTGACACCGGCATTTCGTCCAAGGCCATGGGCATCATGAATTCGTTTGTGAACGACATTTTCGAGCGCATCGCAGGTGAGGCTTCCCGCCTGGCGCATTACAACAAGCGCTCGACCATCACCTCCAGGGAGATCCAGACGGCCGTGCGCCTGCTGCTGCCTGGGGAGTTGGCCAAGCACGCCGTGTCCGAGGGTACTAAGGCCATCACCAAGTACACCAGCGCTAAGCATATGTAG'
bactin = 'ATGGACTACAAGGACGACGACGACAAAGGTGACTACAAAGATGATGACGATAAAGGCGACTATAAGGACGATGACGACAAGGGCGGAAACTCACTGATCAAGGAAAACATGCGGATGAAGGTGGTGATGGAGGGCTCCGTGAATGGTCACCAGTTCAAGTGCACCGGAGAGGGAGAGGGAAACCCGTACATGGGAACTCAGACCATGCGCATTAAGGTCATCGAAGGAGGTCCGCTGCCGTTCGCTTTCGATATCCTGGCCACTTCGTTCGGAGGAGGGTCGCGCACGTTCATCAAGTACCCGAAGGGAATCCCGGACTTCTTTAAGCAGTCATTCCCGGAAGGATTCACTTGGGAACGGGTGACCCGGTATGAAGATGGAGGTGTGGTGACTGTCATGCAAGATACTTCGCTGGAGGATGGGTGCCTCGTGTACCACGTCCAAGTCCGCGGAGTGAATTTCCCGTCCAACGGACCAGTGATGCAGAAAAAGACGAAGGGTTGGGAACCTAATACTGAAATGATGTACCCCGCAGACGGAGGGCTGAGGGGCTACACCCACATGGCGCTGAAGGTCGACGGAGGAGATTACAAGGATGACGACGATAAGCAACAAGATTACAAAGACGATGATGACAAGGGCCAGCAGGGCGACTACAAGGACGACGACGACAAGCAGCAGGACTACAAAGATGACGATGATAAAGGAGGAGGACATCTGTCCTGTTCGTTCGTGACCACCTACAGATCAAAGAAAACCGTGGGAAACATCAAGATGCCGGGCATTCATGCCGTCGACCACCGCCTGGAGCGGCTCGAAGAATCAGACAATGAGATGTTCGTCGTGCAAAGAGAACATGCCGTGGCCAAGTTCGCGGGACTGGGAGGCGGTGGAGGCGATTACAAAGACGATGATGACAAGGGTGACTATAAAGACGACGATGACAAAGGGGATTACAAGGATGATGATGATAAGGGAGGCGGTGGATCAGGTGGAGGAGGTTCACTGCAGGATGATGATATCGCCGCGCTCGTCGTCGACAACGGCTCCGGCATGTGCAAGGCCGGCTTCGCGGGCGACGATGCCCCCCGGGCCGTCTTCCCCTCCATCGTGGGGCGCCCCAGGCACCAGGGCGTGATGGTGGGCATGGGTCAGAAGGATTCCTATGTGGGCGACGAGGCCCAGAGCAAGAGAGGCATCCTCACCCTGAAGTACCCCATCGAGCACGGCATCGTCACCAACTGGGACGACATGGAGAAAATCTGGCACCACACCTTCTACAATGAGCTGCGTGTGGCTCCCGAGGAGCACCCCGTGCTGCTGACCGAGGCCCCCCTGAACCCCAAGGCCAACCGCGAGAAGATGACCCAGATCATGTTTGAGACCTTCAACACCCCAGCCATGTACGTTGCTATCCAGGCTGTGCTATCCCTGTACGCCTCTGGCCGTACCACTGGCATCGTGATGGACTCCGGTGACGGGGTCACCCACACTGTGCCCATCTACGAGGGGTATGCCCTCCCCCATGCCATCCTGCGTCTGGACCTGGCTGGCCGGGACCTGACTGACTACCTCATGAAGATCCTCACCGAGCGCGGCTACAGCTTCACCACCACGGCCGAGCGGGAAATCGTGCGTGACATTAAGGAGAAGCTGTGCTACGTCGCCCTGGACTTCGAGCAAGAGATGGCCACGGCTGCTTCCAGCTCCTCCCTGGAGAAGAGCTACGAGCTGCCTGACGGCCAGGTCATCACCATTGGCAATGAGCGGTTCCGCTGCCCTGAGGCACTCTTCCAGCCTTCCTTCCTGGGCATGGAGTCCTGTGGCATCCACGAAACTACCTTCAACTCCATCATGAAGTGTGACGTGGACATCCGCAAAGACCTGTACGCCAACACAGTGCTGTCTGGCGGCACCACCATGTACCCTGGCATTGCCGACAGGATGCAGAAGGAGATCACTGCCCTGGCACCCAGCACAATGAAGATCAAGATCATTGCTCCTCCTGAGCGCAAGTACTCCGTGTGGATCGGCGGCTCCATCCTGGCCTCGCTGTCCACCTTCCAGCAGATGTGGATCAGCAAGCAGGAGTATGACGAGTCCGGCCCCTCCATCGTCCACCGCAAATGCTTCTAG'

import rsnapsim as rss  
import numpy as np
#convert the sequences to protein objects
bactin = rss.seqmanip.seq_to_protein_obj(bactin)['1'][0]
h2b = rss.seqmanip.seq_to_protein_obj(h2b)['1'][0]
kdm5b = rss.seqmanip.seq_to_protein_obj(kdm5b)['1'][0]

import numpy as np
t = np.linspace(0,2000,2000)
rss.protein = bactin
ssa_soln = rss.solver.solve_ssa(bactin.kelong,t,perturb=[0,1,500,700], low_memory=True,
                                n_traj=10, probe_loc=bactin.probe_loc.astype(np.int32),
                                probe_vec=bactin.probe_vec.astype(np.int32) )

plt.plot(ssa_soln.intensity_vec[0])

plt.figure()
ssa_soln = rss.solver.solve_ssa(bactin.kelong,t,perturb=[0,0,0,0],photobleaching=True,
                                photobleaching_rate=.0002,
                                low_memory=False, n_traj=10,
                                probe_loc=bactin.probe_loc.astype(np.int32),
                                probe_vec=bactin.probe_vec.astype(np.int32) )
plt.plot(ssa_soln.intensity_vec[0])